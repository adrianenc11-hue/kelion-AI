# K1 Forensic Audit
- time_utc: 2026-02-06T13:15:14.901Z
- base: https://kelionai.app
- timeoutMs: 25000
- authProvided: false

## Summary
- total: 12
- ok_2xx: 3
- needs_input_400: 3
- server_5xx: 6
- other_fail: 0

## 5xx Priority Fix List (proof-based)
- **chat-stream** (HTTP 500) — SERVER_BUG
  - hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
  - proof: `{"error":"OpenAI API error: 401"}`
- **vision-compliment** (HTTP 500) — SERVER_BUG
  - hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
  - proof: `{"error":"OpenAI API error: 401"}`
- **memory-cleanup** (HTTP 500) — SERVER_BUG
  - hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
  - proof: `{"error":"column user_memories.expires_at does not exist"}`
- **generate-image** (HTTP 500) — UPSTREAM_AUTH
  - hint: Upstream provider auth failed (OpenAI/Replicate/etc). Check env keys in Netlify.
  - proof: `{"success":false,"error":"You have insufficient permissions for this operation. Missing scopes: api.model.images.request. Check that you have the correct role in your organization (Reader, Writer, Owner) and project (Mem…(truncated)`
- **dalle** (HTTP 500) — UPSTREAM_AUTH
  - hint: Upstream provider auth failed (OpenAI/Replicate/etc). Check env keys in Netlify.
  - proof: `{"error":"401 You have insufficient permissions for this operation. Missing scopes: api.model.images.request. Check that you have the correct role in your organization (Reader, Writer, Owner) and project (Member, Owner),…(truncated)`
- **run-migration** (HTTP 500) — DB
  - hint: Database/storage connectivity/config issue (Supabase URL/key, tables, migrations).
  - proof: `{"error":"getaddrinfo ENOTFOUND db.lqhkqznjdrkuvtpsgwhq.supabase.co","results":[],"hint":"Check DATABASE_URL format and credentials"}`

## Full Results
### health
- GET https://kelionai.app/.netlify/functions/health
- status: 200 | latency_ms: 1003
- json_ok: true
- classification: OTHER
- hint: Check response body/headers.
- body_preview:

```
{
  "healthy": true,
  "timestamp": "2026-02-06T13:15:15.644Z",
  "environment": {
    "configured": 7,
    "total": 7,
    "details": {
      "LLM_API_KEY": true,
      "TTS_API_KEY": true,
      "SEARCH_API_KEY": true,
      "DB_URL": true,
      "VECTOR_DB_API_KEY": true,
      "ENCRYPTION_KEY": true,
      "JWT_SIGNING_KEY": true
    }
  },
  "services": {
    "chat": "ready",
    "tts": "ready",
    "search": "ready",
    "memory": "ready",
    "encryption": "ready"
  }
}
```

### realtime-token
- GET https://kelionai.app/.netlify/functions/realtime-token
- status: 200 | latency_ms: 818
- json_ok: true
- classification: OTHER
- hint: Check response body/headers.
- body_preview:

```
{"object":"realtime.session","id":"sess_D6Fy0viUNcWkTS8XCY80y","model":"gpt-4o-realtime","modalities":["audio","text"],"instructions":"You are K (Kelion), a friendly AI hologram assistant with a camera.\n\nCURRENT TIME: Friday, 6 February 2026 at 13:15 (UK timezone)\n\nCRITICAL LOCATION RULE:\n- NEVER assume the user is in any specific country or city\n- ALWAYS use ONLY the GPS location data provided to you\n- The user's REAL location is in the system context - USE IT\n- For \"tomorrow\" or future weather, use the SAME GPS location, not a different country\n- ONLY use a different location if the user EXPLICITLY names a city\n\nLOGIC VERIFICATION (CRITICAL):\nYou MUST continuously verify the LOGIC of everything:\n1. TIME AWARENESS: If user says \"good morning\" but it's evening, politely correct them: \"Actually, it's evening now - good evening!\"\n2. REALITY CHECK: Verify facts and statements against known reality\n3. CONSISTENCY: Point out contradictions in what user says (politely)\n4. CONTEXT: Consider time of day, season, location in your responses\n5. Be helpful when correcting - don't be rude, just gently inform\n\nCRITICAL SILENCE RULES:\n1. IGNORE background voices, TV, rad…(truncated)
```

### chat
- POST https://kelionai.app/.netlify/functions/chat
- status: 200 | latency_ms: 1467
- json_ok: true
- classification: OTHER
- hint: Check response body/headers.
- body_preview:

```
{"choices":[{"message":{"role":"assistant","content":"Hello! How can I help you today? If you have any questions or need information, feel free to ask."}}],"model":"moonshot-v1-128k","source":"kimi"}
```

### chat-stream
- POST https://kelionai.app/.netlify/functions/chat-stream
- status: 500 | latency_ms: 1147
- json_ok: true
- classification: SERVER_BUG
- hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
- body_preview:

```
{"error":"OpenAI API error: 401"}
```

### smart-brain
- POST https://kelionai.app/.netlify/functions/smart-brain
- status: 400 | latency_ms: 477
- json_ok: true
- classification: NEEDS_INPUT
- hint: 400: endpoint needs body/params (normal for whisper/vision etc.)
- body_preview:

```
{"error":"Question is required"}
```

### vision-compliment
- POST https://kelionai.app/.netlify/functions/vision-compliment
- status: 500 | latency_ms: 1216
- json_ok: true
- classification: SERVER_BUG
- hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
- body_preview:

```
{"error":"OpenAI API error: 401"}
```

### memory-cleanup
- POST https://kelionai.app/.netlify/functions/memory-cleanup
- status: 500 | latency_ms: 612
- json_ok: true
- classification: SERVER_BUG
- hint: Unhandled exception in function. Add try/catch + structured error output + check logs.
- body_preview:

```
{"error":"column user_memories.expires_at does not exist"}
```

### generate-image
- POST https://kelionai.app/.netlify/functions/generate-image
- status: 500 | latency_ms: 617
- json_ok: true
- classification: UPSTREAM_AUTH
- hint: Upstream provider auth failed (OpenAI/Replicate/etc). Check env keys in Netlify.
- body_preview:

```
{"success":false,"error":"You have insufficient permissions for this operation. Missing scopes: api.model.images.request. Check that you have the correct role in your organization (Reader, Writer, Owner) and project (Member, Owner), and if you're using a restricted API key, that it has the necessary scopes."}
```

### dalle
- POST https://kelionai.app/.netlify/functions/dalle
- status: 500 | latency_ms: 540
- json_ok: true
- classification: UPSTREAM_AUTH
- hint: Upstream provider auth failed (OpenAI/Replicate/etc). Check env keys in Netlify.
- body_preview:

```
{"error":"401 You have insufficient permissions for this operation. Missing scopes: api.model.images.request. Check that you have the correct role in your organization (Reader, Writer, Owner) and project (Member, Owner), and if you're using a restricted API key, that it has the necessary scopes."}
```

### run-migration
- POST https://kelionai.app/.netlify/functions/run-migration
- status: 500 | latency_ms: 338
- json_ok: true
- classification: DB
- hint: Database/storage connectivity/config issue (Supabase URL/key, tables, migrations).
- body_preview:

```
{"error":"getaddrinfo ENOTFOUND db.lqhkqznjdrkuvtpsgwhq.supabase.co","results":[],"hint":"Check DATABASE_URL format and credentials"}
```

### whisper
- POST https://kelionai.app/.netlify/functions/whisper
- status: 400 | latency_ms: 371
- json_ok: true
- classification: NEEDS_INPUT
- hint: 400: endpoint needs body/params (normal for whisper/vision etc.)
- body_preview:

```
{"error":"Audio data required (base64)"}
```

### vision
- POST https://kelionai.app/.netlify/functions/vision
- status: 400 | latency_ms: 314
- json_ok: true
- classification: NEEDS_INPUT
- hint: 400: endpoint needs body/params (normal for whisper/vision etc.)
- body_preview:

```
{"error":"Image (base64) is required"}
```
