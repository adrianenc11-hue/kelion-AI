<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description" content="Discover Kelion AI Premium features: unlimited AI chat, 10+ expert professions, real-time browsing, trading bot, voice assistant, and more.">
    <meta name="keywords" content="premium AI features, Kelion AI premium, AI capabilities">
    <meta name="author" content="Kelion AI">
    <meta name="robots" content="index, follow">
    <!-- Open Graph -->
    <meta property="og:title" content="Premium Features ‚Äî Kelion AI">
    <meta property="og:description" content="Discover Kelion AI Premium features: unlimited AI chat, 10+ expert professions, real-time browsing, trading bot, voice assistant, and more.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kelionai.app/premium.html">
    <meta property="og:image" content="https://kelionai.app/hologram-512.png">
    <meta property="og:site_name" content="Kelion AI">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Premium Features ‚Äî Kelion AI">
    <meta name="twitter:description" content="Discover Kelion AI Premium features: unlimited AI chat, 10+ expert professions, real-time browsing, trading bot, voice assistant, and more.">
    <meta name="twitter:image" content="https://kelionai.app/hologram-512.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K1 Premium - Document Intelligence</title>
    <link rel="icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f0f23 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #d4af37 0%, #f4d47c 50%, #d4af37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .back-link {
            color: #888;
            text-decoration: none;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #d4af37;
        }

        .subscription-badge {
            background: linear-gradient(135deg, #d4af37, #f4d47c);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .subscription-badge.free {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #fff;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 24px;
        }

        .upload-zone:hover {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.05);
        }

        .upload-zone.dragover {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }

        .upload-zone.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .upload-text {
            color: #888;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 0.85rem;
            color: #666;
        }

        #file-input {
            display: none;
        }

        /* File List */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background 0.3s;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .file-name {
            font-weight: 500;
        }

        .file-size {
            font-size: 0.8rem;
            color: #888;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .file-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #d4af37;
        }

        /* Process Panel */
        .process-panel {
            margin-top: 24px;
        }

        .process-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .format-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .format-btn:hover {
            border-color: rgba(212, 175, 55, 0.5);
        }

        .format-btn.active {
            background: rgba(212, 175, 55, 0.2);
            border-color: #d4af37;
        }

        .process-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #d4af37, #f4d47c);
            border: none;
            border-radius: 12px;
            color: #000;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .process-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .process-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Memory Panel */
        .memory-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #d4af37;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .memory-search {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .memory-search input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 16px;
            color: #fff;
            font-size: 0.95rem;
        }

        .memory-search input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .search-btn {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: #d4af37;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-btn:hover {
            background: rgba(212, 175, 55, 0.3);
        }

        .memory-results {
            max-height: 200px;
            overflow-y: auto;
        }

        .memory-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #ccc;
        }

        /* Jobs Panel */
        .jobs-list {
            max-height: 250px;
            overflow-y: auto;
        }

        .job-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .job-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .job-status.pending {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
        }

        .job-status.running {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .job-status.done {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .job-status.failed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Upgrade prompt */
        .upgrade-prompt {
            text-align: center;
            padding: 60px 40px;
        }

        .upgrade-prompt h2 {
            font-size: 1.8rem;
            margin-bottom: 16px;
        }

        .upgrade-prompt p {
            color: #888;
            margin-bottom: 24px;
        }

        .upgrade-btn {
            display: inline-block;
            padding: 16px 32px;
            background: linear-gradient(135deg, #d4af37, #f4d47c);
            color: #000;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .upgrade-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        /* Message */
        .message {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.3);
            color: #4ade80;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div>
                <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                    <a href="/app.html" class="back-link">‚Üê Back to Kelion AI</a>
                    <a href="/admin.html" class="back-link" id="admin-back-link" style="display: none;">‚Üê Back to
                        Admin</a>
                </div>
                <h1>K1 Document Intelligence</h1>
            </div>
            <div class="header-actions">
                <span id="subscription-badge" class="subscription-badge free">Free</span>
            </div>
        </div>

        <div id="message" class="message"></div>

        <!-- Upgrade Prompt (shown for free users) -->
        <div id="upgrade-prompt" class="card upgrade-prompt">
            <h2>üîí Premium Feature</h2>
            <p>Document Intelligence is available for premium subscribers. Upgrade now to unlock unlimited document
                uploads, AI analysis, and exports.</p>
            <a href="/subscribe.html" class="upgrade-btn">Upgrade to Premium</a>
        </div>

        <!-- Premium Content (hidden for free users) -->
        <div id="premium-content" class="hidden">
            <div class="main-grid">
                <div class="main-content">
                    <!-- Upload Section -->
                    <div class="card">
                        <h2>üìÑ Upload Documents</h2>
                        <div class="upload-zone" id="upload-zone">
                            <div class="upload-icon">üìÅ</div>
                            <div class="upload-text">Drop files here or click to upload</div>
                            <div class="upload-hint">Supports PDF, images, Word, Excel, text files</div>
                        </div>
                        <input type="file" id="file-input" multiple
                            accept=".pdf,.png,.jpg,.jpeg,.gif,.doc,.docx,.xls,.xlsx,.txt,.csv">

                        <div class="file-list" id="file-list"></div>

                        <div class="process-panel">
                            <h3 style="margin-bottom: 12px; font-size: 0.95rem; color: #888;">Export Format</h3>
                            <div class="process-options">
                                <button class="format-btn active" data-format="json">JSON</button>
                                <button class="format-btn" data-format="txt">Text</button>
                                <button class="format-btn" data-format="pdf">PDF</button>
                                <button class="format-btn" data-format="docx">Word</button>
                                <button class="format-btn" data-format="xlsx">Excel</button>
                            </div>
                            <button class="process-btn" id="process-btn" disabled>Process Selected Files</button>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <!-- Memory Stats -->
                    <div class="card">
                        <h2>üß† Memory</h2>
                        <div class="memory-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="stat-files">0</div>
                                <div class="stat-label">Files</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-memories">0</div>
                                <div class="stat-label">Memories</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="stat-exports">0</div>
                                <div class="stat-label">Exports</div>
                            </div>
                        </div>
                        <div class="memory-search">
                            <input type="text" id="memory-query" placeholder="Search memories...">
                            <button class="search-btn" onclick="searchMemory()">üîç</button>
                        </div>
                        <div class="memory-results" id="memory-results"></div>
                    </div>

                    <!-- Recent Jobs -->
                    <div class="card" style="margin-top: 20px;">
                        <h2>‚öôÔ∏è Recent Jobs</h2>
                        <div class="jobs-list" id="jobs-list">
                            <p style="color: #666; text-align: center; padding: 20px;">No recent jobs</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/components/k1-client.js"></script>
    <script>
        let selectedFiles = [];
        let selectedFormat = 'json';
        let uploadedFiles = [];

        // Check access on load
        document.addEventListener('DOMContentLoaded', async () => {
            // First check if admin (from localStorage)
            const userDataStr = localStorage.getItem('kelion_user');
            if (userDataStr) {
                try {
                    const userData = JSON.parse(userDataStr);
                    if (userData.role === 'admin' || userData.role === 'superadmin') {
                        document.getElementById('admin-back-link').style.display = 'inline-flex';
                        // Admin gets full access
                        const badge = document.getElementById('subscription-badge');
                        badge.textContent = 'üîì Admin';
                        badge.classList.remove('free');
                        badge.style.background = 'linear-gradient(135deg, #ff4444, #cc0000)';

                        // Show premium content
                        document.getElementById('upgrade-prompt').classList.add('hidden');
                        document.getElementById('premium-content').classList.remove('hidden');

                        // Load stats
                        loadStats();
                        loadJobs();

                        // Setup event listeners
                        setupUpload();
                        setupFormatButtons();

                        console.log('‚úÖ Admin access granted');
                        return;
                    }
                } catch (e) { }
            }

            const token = localStorage.getItem('kelion_access_token') || localStorage.getItem('kelion_auth_token');

            if (!token) {
                showMessage('Please log in to access K1 features.', 'error');
                return;
            }

            // Decode token
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const subscription = payload.subscription;
                const role = payload.role;

                // Update badge
                const badge = document.getElementById('subscription-badge');

                // Check if admin from token
                if (role === 'admin' || role === 'superadmin') {
                    badge.textContent = 'üîì Admin';
                    badge.classList.remove('free');
                    badge.style.background = 'linear-gradient(135deg, #ff4444, #cc0000)';

                    document.getElementById('upgrade-prompt').classList.add('hidden');
                    document.getElementById('premium-content').classList.remove('hidden');

                    loadStats();
                    loadJobs();
                } else if (subscription && subscription !== 'free') {
                    badge.textContent = subscription.charAt(0).toUpperCase() + subscription.slice(1);
                    badge.classList.remove('free');

                    // Show premium content
                    document.getElementById('upgrade-prompt').classList.add('hidden');
                    document.getElementById('premium-content').classList.remove('hidden');

                    // Initialize K1 client
                    k1Client.setToken(token);

                    // Load stats
                    loadStats();
                    loadJobs();
                }

            } catch (e) {
                console.error('Token decode error:', e);
                showMessage('Session expired. Please log in again.', 'error');
            }

            // Setup event listeners
            setupUpload();
            setupFormatButtons();
        });

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type} show`;
            setTimeout(() => msg.classList.remove('show'), 5000);
        }

        function setupUpload() {
            const zone = document.getElementById('upload-zone');
            const input = document.getElementById('file-input');

            zone.addEventListener('click', () => input.click());

            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            input.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        async function handleFiles(files) {
            for (const file of files) {
                try {
                    showMessage(`Uploading ${file.name}...`, 'success');
                    const result = await k1Client.uploadFile(file);

                    if (result.file_id) {
                        uploadedFiles.push({
                            id: result.file_id,
                            name: file.name,
                            size: file.size
                        });
                        renderFileList();
                        showMessage(`${file.name} uploaded successfully!`, 'success');
                    }
                } catch (error) {
                    showMessage(`Failed to upload ${file.name}: ${error.message}`, 'error');
                }
            }

            document.getElementById('process-btn').disabled = uploadedFiles.length === 0;
        }

        function renderFileList() {
            const list = document.getElementById('file-list');
            list.innerHTML = uploadedFiles.map(file => `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-icon">üìÑ</div>
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatSize(file.size)}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-btn" onclick="processFile('${file.id}')">‚ö°</button>
                        <button class="file-btn" onclick="removeFile('${file.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function removeFile(fileId) {
            uploadedFiles = uploadedFiles.filter(f => f.id !== fileId);
            renderFileList();
            document.getElementById('process-btn').disabled = uploadedFiles.length === 0;
        }

        function setupFormatButtons() {
            document.querySelectorAll('.format-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedFormat = btn.dataset.format;
                });
            });

            document.getElementById('process-btn').addEventListener('click', processAllFiles);
        }

        async function processFile(fileId) {
            try {
                showMessage('Processing file...', 'success');
                const result = await k1Client.processFile(fileId, {
                    output_format: selectedFormat,
                    title: 'K1 Analysis'
                });
                showMessage('File processed! Check Recent Jobs for status.', 'success');
                loadJobs();
            } catch (error) {
                showMessage(`Process failed: ${error.message}`, 'error');
            }
        }

        async function processAllFiles() {
            for (const file of uploadedFiles) {
                await processFile(file.id);
            }
        }

        async function loadStats() {
            try {
                const stats = await k1Client.memoryStats();
                document.getElementById('stat-files').textContent = stats.files || 0;
                document.getElementById('stat-memories').textContent = stats.total || 0;
                document.getElementById('stat-exports').textContent = stats.exports || 0;
            } catch (e) {
                console.log('Stats not available');
            }
        }

        async function loadJobs() {
            try {
                const jobs = await k1Client.listJobs(null, 10);
                const list = document.getElementById('jobs-list');

                if (jobs.jobs && jobs.jobs.length > 0) {
                    list.innerHTML = jobs.jobs.map(job => `
                        <div class="job-item">
                            <div>
                                <div style="font-weight: 500;">${job.type || 'Process'}</div>
                                <div style="font-size: 0.8rem; color: #888;">${new Date(job.created_at).toLocaleString()}</div>
                            </div>
                            <span class="job-status ${job.status}">${job.status}</span>
                        </div>
                    `).join('');
                }
            } catch (e) {
                console.log('Jobs not available');
            }
        }

        async function searchMemory() {
            const query = document.getElementById('memory-query').value;
            if (!query) return;

            try {
                const results = await k1Client.searchMemory(query);
                const container = document.getElementById('memory-results');

                if (results.results && results.results.length > 0) {
                    container.innerHTML = results.results.map(r => `
                        <div class="memory-item">${r.content}</div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="color: #666; text-align: center;">No results found</p>';
                }
            } catch (error) {
                showMessage(`Search failed: ${error.message}`, 'error');
            }
        }
    </script>

<!-- Push Notifications + i18n -->
<script>
// ‚ïê‚ïê‚ïê SERVICE WORKER + PUSH NOTIFICATIONS ‚ïê‚ïê‚ïê
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(reg => {
        console.log('[K] Service Worker registered');
    }).catch(err => console.warn('[K] SW registration failed:', err));
}

async function subscribePush() {
    try {
        if (!('PushManager' in window)) { alert('Push notifications not supported'); return; }
        
        const reg = await navigator.serviceWorker.ready;
        const existing = await reg.pushManager.getSubscription();
        if (existing) { console.log('[K] Already subscribed'); return existing; }
        
        // Get VAPID key from server
        const r = await fetch('/.netlify/functions/push-notifications', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ action: 'get_vapid_key' })
        });
        const { vapid_public_key } = await r.json();
        if (!vapid_public_key) { console.warn('[K] No VAPID key'); return null; }
        
        // Convert base64url to Uint8Array
        const urlBase64ToUint8Array = (base64String) => {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
            const rawData = atob(base64);
            return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
        };
        
        const sub = await reg.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(vapid_public_key)
        });
        
        // Send to server
        const email = localStorage.getItem('k_email') || 'anonymous';
        await fetch('/.netlify/functions/push-notifications', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ action: 'subscribe', subscription: sub, user_email: email })
        });
        
        console.log('[K] Push subscribed!');
        return sub;
    } catch(e) { console.error('[K] Push subscribe error:', e); }
}

// ‚ïê‚ïê‚ïê i18n LANGUAGE SYSTEM ‚ïê‚ïê‚ïê
const K_LANGS = { en: 'English', ro: 'Rom√¢nƒÉ', es: 'Espa√±ol', fr: 'Fran√ßais', de: 'Deutsch' };
let K_I18N = {};

function getLanguage() {
    return localStorage.getItem('k_lang') || navigator.language?.split('-')[0] || 'en';
}

async function loadTranslations(lang) {
    try {
        const r = await fetch('/.netlify/functions/i18n', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ lang: lang || getLanguage() })
        });
        const d = await r.json();
        if (d.success) { K_I18N = d.translations; applyTranslations(); }
    } catch(e) { console.warn('[K] i18n load error:', e); }
}

function t(key) { return K_I18N[key] || key; }

function applyTranslations() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (K_I18N[key]) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = K_I18N[key];
            else el.textContent = K_I18N[key];
        }
    });
}

function setLanguage(lang) {
    localStorage.setItem('k_lang', lang);
    loadTranslations(lang);
}

// Auto-load on page ready
document.addEventListener('DOMContentLoaded', () => {
    loadTranslations();
    
    // Auto-ask for push after 30s on first visit
    if (!localStorage.getItem('k_push_asked')) {
        setTimeout(() => {
            if (Notification.permission === 'default') {
                Notification.requestPermission().then(p => {
                    if (p === 'granted') subscribePush();
                    localStorage.setItem('k_push_asked', '1');
                });
            }
        }, 30000);
    }
});
</script>

</body>

</html>